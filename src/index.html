<!DOCTYPE html>
<html>
<head>
    <style>
        :root { --red: #ff4d4d; --dark: #2d3436; --gray: #f9f9f9; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; background: var(--gray); display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }
        .container { background: white; width: 350px; border-radius: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); padding: 25px; text-align: center; }
        h2 { color: var(--red); margin-bottom: 20px; font-weight: 800; }
        
        .timer-box { font-size: 55px; font-weight: bold; margin: 20px 0; color: var(--dark); background: #fff5f5; border-radius: 15px; padding: 10px; border: 2px dashed var(--red); }
        
        .input-group { text-align: left; margin-bottom: 15px; }
        label { font-size: 12px; font-weight: bold; color: #666; margin-left: 5px; }
        input { width: 100%; padding: 12px; margin-top: 5px; border: 2px solid #eee; border-radius: 10px; box-sizing: border-box; outline: none; transition: 0.3s; }
        input:focus { border-color: var(--red); }

        .app-chip { display: inline-block; background: #eee; padding: 5px 10px; border-radius: 15px; font-size: 12px; margin: 3px; }

        .btn { width: 100%; padding: 15px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; font-size: 15px; margin-top: 10px; transition: 0.2s; }
        .btn-start { background: var(--red); color: white; }
        .btn-start:hover { background: #e04545; }
        .btn-stop { background: var(--dark); color: white; }
        
        .hidden { display: none; }
        .overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: var(--red); z-index: 999; display: flex; flex-direction: column; justify-content: center; align-items: center; color: white; }
    </style>
</head>
<body>

    <div class="container" id="setup-view">
        <h2>FocusPro ðŸ”’</h2>
        
        <div class="input-group">
            <label>FOCUS TIME (MINUTES)</label>
            <input type="number" id="time-input" value="25">
        </div>

        <div class="input-group">
            <label>APPS TO BLOCK (Comma separated)</label>
            <input type="text" id="app-input" placeholder="chrome.exe, msedge.exe, discord.exe">
            <p style="font-size: 10px; color: #999;">*Add .exe at the end of each app</p>
        </div>

        <button class="btn btn-start" onclick="startFocus()">START FOCUS NOW</button>
    </div>

    <div class="overlay hidden" id="focus-view">
        <h1 style="font-size: 20px; letter-spacing: 2px;">STRICT FOCUS ACTIVE</h1>
        <div class="timer-box" id="timer-display" style="border:none; color: white; background: transparent;">25:00</div>
        
        <div style="width: 300px; background: white; padding: 20px; border-radius: 15px; color: #333;">
            <p style="font-size: 13px; margin-bottom: 10px;">Enter Password to Emergency Unlock:</p>
            <input type="password" id="pass-input" placeholder="Password">
            <button class="btn btn-stop" onclick="unlock()">UNLOCK</button>
        </div>
    </div>

    <script>
        const { invoke } = window.__TAURI__.tauri;
        let timer;

        async function startFocus() {
            const appsRaw = document.getElementById('app-input').value;
            const mins = document.getElementById('time-input').value;
            
            if(!appsRaw) { alert("Please enter at least one app!"); return; }
            
            const appList = appsRaw.split(',').map(s => s.trim());
            let seconds = mins * 60;

            // Start Backend Blocking
            await invoke('start_focus', { apps: appList });

            // UI Changes
            document.getElementById('setup-view').classList.add('hidden');
            document.getElementById('focus-view').classList.remove('hidden');

            // Countdown Logic
            timer = setInterval(() => {
                seconds--;
                let m = Math.floor(seconds / 60);
                let s = seconds % 60;
                document.getElementById('timer-display').innerText = `${m}:${s < 10 ? '0' : ''}${s}`;
                
                if(seconds <= 0) {
                    clearInterval(timer);
                    alert("Time up! Great Job.");
                    location.reload();
                }
            }, 1000);
        }

        async function unlock() {
            const pass = document.getElementById('pass-input').value;
            const success = await invoke('stop_focus', { input_pass: pass });
            if(success) {
                clearInterval(timer);
                location.reload();
            } else {
                alert("Incorrect Password!");
            }
        }
    </script>
</body>
</html>