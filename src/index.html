<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary: #00ff88; --bg: #0f172a; --card: #1e293b; --text: #f8fafc; }
        body { font-family: 'Inter', sans-serif; margin: 0; background: var(--bg); color: var(--text); display: flex; height: 100vh; }
        
        /* Sidebar */
        .sidebar { width: 70px; background: #020617; display: flex; flex-direction: column; align-items: center; padding: 20px 0; gap: 30px; border-right: 1px solid #334155; }
        .icon { font-size: 24px; cursor: pointer; opacity: 0.5; transition: 0.3s; }
        .icon:hover, .active { opacity: 1; color: var(--primary); }

        /* Main Area */
        .container { flex: 1; padding: 30px; display: grid; grid-template-columns: 2fr 1fr; grid-template-rows: auto 1fr; gap: 20px; overflow-y: auto; }
        
        .header { grid-column: span 2; display: flex; justify-content: space-between; align-items: center; background: var(--card); padding: 20px; border-radius: 20px; }
        
        .card { background: var(--card); border-radius: 20px; padding: 20px; border: 1px solid #334155; }

        /* Timer UI */
        .timer-box { text-align: center; }
        .timer-display { font-size: 80px; font-weight: 900; font-family: 'Courier New', Courier, monospace; color: var(--primary); margin: 10px 0; }
        .btn-main { background: var(--primary); color: #000; border: none; padding: 15px 40px; border-radius: 12px; font-weight: bold; cursor: pointer; font-size: 16px; }

        /* Task List */
        .task-list { max-height: 300px; overflow-y: auto; }
        .task-item { background: #334155; padding: 10px; border-radius: 10px; margin-bottom: 8px; display: flex; align-items: center; gap: 10px; }

        /* Graph Box */
        .graph-box { grid-column: span 1; }

        /* Lock Screen Overlay */
        #lock-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 10000; display: none; flex-direction: column; justify-content: center; align-items: center; }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="icon active">üè†</div>
        <div class="icon">üìà</div>
        <div class="icon">üéØ</div>
        <div class="icon">‚öôÔ∏è</div>
    </div>

    <div class="container">
        <div class="header">
            <div>
                <h2 style="margin:0">Welcome Back, Focus Master! ‚ö°</h2>
                <p style="color:#94a3b8; margin:5px 0 0 0">You have 4 tasks remaining for today.</p>
            </div>
            <div style="text-align: right">
                <span style="background:var(--primary); color:#000; padding:5px 15px; border-radius:20px; font-weight:bold">Rank: Pro</span>
            </div>
        </div>

        <div class="card timer-box">
            <h3>Focus Timer üïí</h3>
            <div class="timer-display" id="main-timer">25:00</div>
            <div style="margin-bottom: 20px;">
                <input type="text" id="apps" placeholder="Apps: chrome.exe, discord.exe" style="width:70%; padding:10px; border-radius:8px; border:none;">
            </div>
            <button class="btn-main" onclick="startFocus()">IGNITE FOCUS</button>
        </div>

        <div class="card graph-box">
            <h3>Weekly Focus Activity üìä</h3>
            <canvas id="focusChart" height="200"></canvas>
        </div>

        <div class="card">
            <h3>To-Do List ‚úÖ</h3>
            <div class="task-list" id="tasks">
                <div class="task-item"><input type="checkbox"> Finish Math Assignment</div>
                <div class="task-item"><input type="checkbox"> Code Tauri Backend</div>
                <div class="task-item"><input type="checkbox"> Push to GitHub</div>
            </div>
            <input type="text" id="new-task" placeholder="+ Add a task" style="width:100%; background:transparent; border:1px solid #334155; color:white; padding:10px; margin-top:10px; border-radius:8px;">
        </div>

        <div class="card" style="display:flex; align-items:center; justify-content:center; text-align:center; font-style:italic; color:#94a3b8">
            "Your focus determines your reality." - Qui-Gon Jinn
        </div>
    </div>

    <div id="lock-screen">
        <h1 style="color:var(--primary); font-size: 50px;">STRICT MODE ON</h1>
        <div id="lock-timer" style="font-size: 120px; font-weight:900; margin: 40px 0;">25:00</div>
        <input type="password" id="pass" placeholder="Unlock Password" style="padding:15px; border-radius:10px; border:none; width:300px; text-align:center;">
        <button onclick="stopFocus()" style="margin-top:20px; background:red; color:white; border:none; padding:10px 20px; border-radius:8px; cursor:pointer;">EMERGENCY STOP</button>
    </div>

    <script>
        const { invoke } = window.__TAURI__.tauri;
        let timeLeft = 25 * 60;
        let interval;

        // --- Graph Logic ---
        const ctx = document.getElementById('focusChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                datasets: [{
                    label: 'Focus Hours',
                    data: [2, 5, 3, 8, 4, 2, 6],
                    borderColor: '#00ff88',
                    backgroundColor: 'rgba(0, 255, 136, 0.1)',
                    fill: true,
                    tension: 0.4
                }]
            },
            options: { plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, grid: { color: '#334155' } }, x: { grid: { display: false } } } }
        });

        // --- Timer Logic ---
        function updateUI() {
            let m = Math.floor(timeLeft / 60);
            let s = timeLeft % 60;
            let timeStr = `${m}:${s < 10 ? '0' : ''}${s}`;
            document.getElementById('main-timer').innerText = timeStr;
            document.getElementById('lock-timer').innerText = timeStr;
        }

        async function startFocus() {
            let apps = document.getElementById('apps').value.split(',').map(a => a.trim());
            if(!apps[0]) return alert("Add apps to block!");

            document.getElementById('lock-screen').style.display = 'flex';
            await invoke('start_focus', { apps });

            interval = setInterval(() => {
                timeLeft--;
                updateUI();
                if(timeLeft <= 0) {
                    clearInterval(interval);
                    location.reload();
                }
            }, 1000);
        }

        async function stopFocus() {
            let pass = document.getElementById('pass').value;
            let ok = await invoke('stop_focus', { input_pass: pass });
            if(ok) location.reload(); else alert("Wrong Password!");
        }
    </script>
</body>
</html>